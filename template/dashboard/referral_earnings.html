{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Referral Earnings - CPA Network{% endblock %}

{% block content %}
<!--app-content open-->
<div class="app-content">
	<div class="side-app">

		<!-- PAGE-HEADER -->
		<div class="page-header">
			<div>
				<h1 class="page-title">Referral Earnings</h1>
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
					<li class="breadcrumb-item"><a href="{% url 'referral_dashboard' %}">Referrals</a></li>
					<li class="breadcrumb-item active">Referral Earnings</li>
				</ol>
			</div>
		</div>
		<!-- PAGE-HEADER END -->

		<!-- ROW -->
		<div class="row">
			<!-- Total Earnings Card -->
			<div class="col-xl-3 col-lg-6 col-md-6">
				<div class="card">
					<div class="card-body">
						<div class="row">
							<div class="col-8">
								<div class="mt-0 text-start">
									<span class="fs-14 font-weight-semibold">Total Earnings</span>
									<h3 class="mb-0 mt-1 text-primary">${{ total_earnings|floatformat:2 }}</h3>
								</div>
							</div>
							<div class="col-4">
								<div class="mt-0 text-end">
									<span class="fs-25 text-primary"><i class="fas fa-dollar-sign"></i></span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Total Conversions Card -->
			<div class="col-xl-3 col-lg-6 col-md-6">
				<div class="card">
					<div class="card-body">
						<div class="row">
							<div class="col-8">
								<div class="mt-0 text-start">
									<span class="fs-14 font-weight-semibold">Total Conversions</span>
									<h3 class="mb-0 mt-1 text-success">{{ total_conversions }}</h3>
								</div>
							</div>
							<div class="col-4">
								<div class="mt-0 text-end">
									<span class="fs-25 text-success"><i class="fas fa-chart-line"></i></span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Average Earnings Card -->
			<div class="col-xl-3 col-lg-6 col-md-6">
				<div class="card">
					<div class="card-body">
						<div class="row">
							<div class="col-8">
								<div class="mt-0 text-start">
									<span class="fs-14 font-weight-semibold">Average Earnings</span>
									<h3 class="mb-0 mt-1 text-info">
										${{ average_earnings|floatformat:2 }}
									</h3>
								</div>
							</div>
							<div class="col-4">
								<div class="mt-0 text-end">
									<span class="fs-25 text-info"><i class="fas fa-calculator"></i></span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Commission Rate Card -->
			<div class="col-xl-3 col-lg-6 col-md-6">
				<div class="card">
					<div class="card-body">
						<div class="row">
							<div class="col-8">
								<div class="mt-0 text-start">
									<span class="fs-14 font-weight-semibold">Commission Rate</span>
									<h3 class="mb-0 mt-1 text-warning">{{ site_settings.referral_percentage|default:5 }}%</h3>
								</div>
							</div>
							<div class="col-4">
								<div class="mt-0 text-end">
									<span class="fs-25 text-warning"><i class="fas fa-percentage"></i></span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- ROW END -->

		<!-- ROW -->
		<div class="row">
			<div class="col-12">
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">Referral Earnings History</h3>
						<div class="card-options">
							<span class="text-muted">Detailed earnings from your referrals</span>
						</div>
					</div>
					<div class="card-body">
						{% if earnings %}
						<div class="table-responsive">
							<table class="table table-bordered text-nowrap border-bottom">
								<thead>
									<tr>
										<th class="border-bottom-0">Referred User</th>
										<th class="border-bottom-0">Offer</th>
										<th class="border-bottom-0">Conversion Date</th>
										<th class="border-bottom-0">Amount</th>
										<th class="border-bottom-0">Commission Rate</th>
										<th class="border-bottom-0">Earning Date</th>
									</tr>
								</thead>
								<tbody>
									{% for earning in earnings %}
									<tr>
										<td>
											<div class="d-flex align-items-center">
												<div class="me-3">
													<span class="avatar avatar-md bg-primary-gradient rounded-circle">
														<i class="fas fa-user text-white"></i>
													</span>
												</div>
												<div>
													<h6 class="mb-0 fw-semibold">{{ earning.referral.referred_user.full_name }}</h6>
													<small class="text-muted">{{ earning.referral.referred_user.email }}</small>
												</div>
											</div>
										</td>
										<td>
											<span class="fw-semibold">{{ earning.conversion.click_tracking.offer.offer_name }}</span>
										</td>
										<td>
											<span class="text-muted">{{ earning.conversion.conversion_date|date:"M d, Y" }}</span>
										</td>
										<td>
											<span class="fw-semibold fs-16 text-primary">{{ earning.formatted_amount }}</span>
										</td>
										<td>
											<span class="badge bg-info">{{ earning.formatted_percentage }}</span>
										</td>
										<td>
											<span class="text-muted">{{ earning.created_at|date:"M d, Y" }}</span>
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
						{% else %}
						<div class="text-center py-5">
							<div class="mb-4">
								<span class="avatar avatar-xxl bg-light rounded-circle">
									<i class="fas fa-dollar-sign text-muted" style="font-size: 3rem;"></i>
								</span>
							</div>
							<h4 class="text-muted mb-3">No Earnings Yet</h4>
							<p class="text-muted mb-4">You haven't earned any commissions from referrals yet. Start sharing your referral link!</p>
						</div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
		<!-- ROW END -->

	</div>
</div>
<!--app-content close-->

<style>
.card {
    border: none;
    box-shadow: 0 0 20px rgba(0,0,0,0.08);
    border-radius: 10px;
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 25px rgba(0,0,0,0.15);
}

.bg-primary-gradient {
    background: linear-gradient(45deg, #007bff, #0056b3);
}

.avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.table {
    border-radius: 10px;
    overflow: hidden;
}

.table thead th {
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    color: #495057;
}

.badge {
    font-size: 0.75rem;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
}
</style>
{% endblock %} 